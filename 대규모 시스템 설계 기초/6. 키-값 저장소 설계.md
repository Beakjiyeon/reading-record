
### 키-값 저장소란?
- 키-값 저장소에서 키는 유일해야 한다. 
- 키는 일반 텍스트거나 해시 값일 수 있다.
- 키는 짧을 수록 성능이 좋다. 
- 키-값 저장소로 aws 다이나모, memcached, 레디스 등이 널리 알려져 있다.

### 단일 서버 키-값 저장소
- 설계 : 키-값 쌍 전부 메모리에 해시 테이블로 저장한다.
  - 장점 : 빠른 속도를 보장한다.
  - 단점 : 모든 데이터를 메모리에 두기 부족할 수 있다.
  - 개선책 : 데이터 압축, 자주 쓰는 데이터만 메모리에 두고 나머지는 디스크에 저장
  - 그러나 많은 데이터를 저장하려면 분산 키-값 저장소를 만들어야 한다.

### 분산 키-값 저장소
- 분산 해시 테이블이라고도 불린다.
- 분산 키-값 저장소를 설계할 때는 CAP (일관성, 가용성, 파티션 감내) 정리를 인지해야 한다.
- 통상 네트워크 장애는 피할 수 없으므로 CA 시스템은 존재하지 않는다.


## 키-값 저장소 구현에 사용될 핵심 컴포넌트
### 데이터 파티션
- 고려 사항 : 여러 서버에 데이터가 고르게 분산 되는가, 노드 추가/삭제 시 데이터 이동이 최소화되는가
- 안정 해시 기술을 권장한다. 규모 확장 자동화(서버 추가/삭제 용이), 다양성(서버의 용량에 맞게 가상 노드 수 조정 용이)


### 데이터 다중화
- 데이터를 다른 곳에 백업하는 것
- 백업할 노드는 다른 지역 데이터 센터에 두고 센터들은 고속 네트워크로 연결한다.


### 일관성
- 다중화된 데이터는 적절히 동기화가 필요하다.
- 정족수의 합 프로토콜을 이용하면 된다.
- N(사본 수), W(쓰기 정족 수), R(읽기 정족 수)는 요구되는 일관성 수준에 따라 타협하면 된다.
- 정족수 : 어떤 조건이 성립되려면 적어도 x개의 상황이 발생해야 한다.
- 일관성 모델
  - 일관성의 수준을 결정한다.
  - 강한 일관성 : 모두 가장 최신 데이터 제공. 장애 발생 시 읽기/쓰기를 금지시킨다. 고가용성 만족 안함
  - 약한 일관성 : 읽기 연산은 최신 데이터를 못 받을 수 있다.
  - 최종 일관성 : 약한 일관성의 일종이다. 결국엔 다 보이게 된다. 병렬 쓰기 작업이 있을 경우 클라이언트 단위에서 일관성 깨질 가능성을 막을 수 있다.

### 일관성 불일치 해소
- 버저닝 : 데이터를 변경할 때마다 새로운 버전 생성한다. 이전 버전 데이터는 변경이 불가능하다.
- 벡터 시계 : D[서버,버전]

### 장애 처리
### 시스템 아키텍처 다이어그램
### 쓰기 경로
### 읽기 경로

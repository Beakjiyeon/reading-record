# 7. 분산 시스템을 위한 유일 ID 생성기 설계

### 다중 마스터 복제
- 데이터베이스의 auto increment 기능을 활용하는 것
- 다음 id 값을 구할 때 현재 사용중인 데이터베이스 서버 수 만큼 더한다.
- 장점 : 확장성 문제를 어느 정도 해결할 수 있다. 데이터베이스 수를 늘리면 초당 생성 가능한 id 수도 늘릴 수 있기 때문이다. 
- 단점 : 
  - 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다. 
  - id 의 유일성은 보장되지만 그 값이 시간 흐름에 맞추어 커지도록 보장할 수 없다. 
  - 서버 추가, 삭제할 때도 잘 동작하도록 만들기 어렵다.
<br/>

### UUID
- 간단한 방법
- 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트짜리 수
- 충돌 가능성이 거의 없다. 
- 각 서버별로 id 생성기를 사용해 독립적으로 id를 만든다.
- 장점
  - 단순한 생성 방법 
  - 서버 사이의 조율이 필요 없으므로 동기화 이슈도 없다. 
  - 각 서버가 자기가 쓸 id를 만드므로 규모 확장도 쉽다.
- 단점
  - id가 128비트로 요구사항에 따라 길 수 있다.
  - id를 시간순으로 정렬할 수 없다.
  - id에 숫자 아닌 값이 포함될 수 있다. 
<br/>


### 타겟 서버
- auto_increment 기능을 갖춘 데이터베이스 서버(타겟 서버)를 중앙 집중형으로 하나만 사용한다.
- 장점 
  - 유일성이 보장되는 오직 숫자로만 구성된 id를 만든다.
  - 구현하기 쉽고, 중소 규모 애플리케이션에 적합하다.
- 단점
  - 타겟 서버가 싱글 포인트 오브 페일러 spof가 된다. 
  - 이 이슈를 피하기 위해 타겟 서버를 여러 대 준비하게 되면 데이터 동기화 문제가 발생할 수 있다.
<br/>


### 트위터 스노플레이크 접근법
- id 구조를 '사인, 타임스탬프(utc), 데이터 센터id, 서버 id, 일련 번호'로 구성한다.
- 타임 스탬프 : 시간 흐름에 따라 큰 값을 갖게 되어 id를 시간 순으로 정렬 가능하게 한다.
- 일련 번호 : 어떤 서버가 같은 밀리초 동안 하나 이상의 id를 만들어 낸 경우에만 0보다 큰 값을 갖는다. 보통 타임스탬프로 식별하게 되는 것 같다.
<br/>


### 스노플레이크 접근법 보완
- 시계 동기화 : 스노플레이크 타임스탬프는 하나의 서버가 여러 코어에 실행될 경우 유효하지 않을 수 있다.
- 각 절의 길이 최적화 : 동시서이 낮고 수명이 긴 애플ㄹ리케이션이라면 일련 번호 절의 길이를 줄이고 타임스탬프 절의 길이를 늘리는 것이 효과적일 수 있다.
- 고가용성 : id생성기는 꼭 필요한 컴포넌트이므로 아주 높은 가용성을 제공해야 한다.
<br/>


### 더 알아볼 점
- p.124 시계 동기화에서 코어가 뭘 의미하는지 알아보기. kst 같은 시간대를 의미하는 건지.
- p.119 다중 마스터 복제의 단점이 '여러 데이터 센터에 걸쳐 규모 늘리기 어렵다.'인데 데이터 센터랑 무슨 상관인지 알아보기
- p.118 대화 어느 부분에서 64비트 제한이 있는 지 알아보기
<br/>

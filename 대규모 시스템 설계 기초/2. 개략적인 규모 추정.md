# 2. 개략적인 규모 추정
개략적 규모 추정을 잘 하려면 규모 확장성을 표현하는 데 필요한 기본기에 능숙해야 한다. 2의 제곱수, 응답지연 값, 가용성 관련 수치를 이해하자.

<br/>

## 2의 제곱수
- 분산 시스템에서 다루는 데이터 양은 엄청나게 커질 수 있으나 계산법은 간단하다. 
- 데이터 볼륨의 단위를 2 제곱수로 표현할 때 값을 알아야 한다. 
- 2^10 : 1천 : 1킬로바이트
- 2^20 : 1백만 : 1 메가바이트
- 2^30 : 10억 : 1기가바이트
- 2^40 : 1조 : 1테라바이트
- 2^50 : 1000조 : 1페타바이트
- 아스키 문자 한개 크기 : 1바이트 (최소 단위)

<br/>

## 응답 지연 값
- 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있도록 해준다.
- L1 캐시 참조 : 0.5ns (나노초)
- 분기 예측 오류  : 5ns
- L2 캐시 참조 : 7ns
- 뮤텍스 락/언락 : 100ns
- 주 메모리 참조 : 100ns
- zippy 로 1kb 압축 : 10000ns
- 1 gbps 네트워크로 2kb 전송 : 20000ns
- 메모리에서 1mb 순차적으로 read : 250000ns
- 같은 데이터 센터 내에서 메시지 왕복 지연시간 : 500000ns
- 디스크 탐색 : 10000000ns = 10ms (밀리초)
- 네트워크에서 1mb 순차적으로 read : 10ms
- 디스크에서 1mb 순차적으로 read : 30ms
- 한 패킷의 ca 로부터 네덜란드까지의 왕복 지연시간 : 150ms

<br/>

즉,
- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색은 가능한 피하자
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라
- 데이터 센터는 보통 여러 지역에 분산되어 있고 센터들 간 데이터를 주고받는데 시간이 걸린다.

질문) 메모리와 디스크의 차이는?

<br/>

## 가용성 관계 수치 
- 고가용성이란 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력이다.
- 퍼센트로 표현한다.
- 100%이면 한 번도 중단된적이 없음을 의미한다.
- 대부분의 서비스는 99~100% 값을 갖는다.

<br/>

## 규모 추정 예시
### 가정 
- 월간 능동 사용자는 3억명
- 50% 사용자가 매일 서비스 사용
- 각 사용자는 평균적으로 매일 2건의 글을 올린다.
- 미디어를 포함하는 글은 10%
- 데이터는 5년간 보관된다.

### 추정
- QPS 추정치 = 초당 쿼리 추정치
	- 일간 능동 사용자 = 3억 * 50% = 1.5억
	- QPS = 1.5억 * 게시글 2번 / 24 시간 / 3600초 = 약 3500
		- 24시간 동안 n명의 사용자들이 2번 쿼리 요청을 보낸다. 초당 쿼리수를 구하려면 60 * 60으로 나눈다.
	- 최대 QPS = 2 * QPS = 약 7000
질문) 글을 게시하고 보는 것 까지 포함하여 2번을 곱한 것 같다.
질문) 왜 일간 능동 사용자에 0.50을 곱하지


- 미디어 저장을 위한 저장소 요구량
	- 평균 글 크기
	- 글 Id 64바이트, 텍스트 140바이트, 미디어 1mb
	- 하루 미디어 저장소 요구량 = 1.5억 * 2번 게시글 * 10% * 1mb = 30tb
	- 5년간 미디어 보관 = 30tb * 365 * 5 = 약 55pb


질문) 직접 계산해보기




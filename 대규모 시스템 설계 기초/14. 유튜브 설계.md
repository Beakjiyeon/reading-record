# 14. 유튜브 설계
## 1단계. 문제 이해 및 설계 범위 확정
- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 기능
- 낮은 인프라 비용
- 높은 가용성과 규모 확장성, 그리고 안정성
- 지원 클라이언트 : 모바일 앱, 웹 브라우저, 스마트 티비


## 2단계. 계략적 설계안 제시 및 동의 구하기
### 컴포넌트 구성
- 단말 : 컴퓨터, 모바일 폰, 스마트 tv를 통해서 유튜브를 시청할 수 있다.
- cdn : 비디오는 cdn에 저장한다. 재생 버튼을 누르면 cdn으로부터 스트리밍이 이루어진다.
- api 서버 : 비디오 스트리밍을 제외한 모든 요청은 api서버가 처리한다. 피드 추천, 비디오 업로드 url 생성, 메타데이터 데이터베이스와 캐시 갱신, 사용자 가입 등등이 api 서버가 처리하는 작업이다.
<br/>

### 비디오 업로드 절차
** 주요 컴포넌트
- 메타데이터 데이터 베이스 : 비디오의 메타 데이터를 보관한다. 샤딩, 다중화를 적용하여 성능 및 가용성 요구사항을 충족한다.
- 메타데이터 캐시 : 성능을 높이기 위해 비디오 메타데이터와 사용자 객체를 캐시한다.
- 원본 저장소 : 원본 비디오를 보관할 대형 이진 파일 저장소 시스템이다.
- 트랜스코딩 서버 : 비디오 인코딩을 담당한다. 비디오의 포맷을 변환한다. 단말이나 대역폭 요구사항에 맞는 최적의 비디오 스트림을 제공하기 위해 필요하다.
- 트랜스코딩 비디오 저장소 : 트랜스코딩이 완료된 비디오를 저장하는 blob 저장소다.
- cdn : 비디오를 캐시하는 역할이다. 사용자가 재생버튼을 누르면 비디오 스트리밍은 cdn을 통해 이뤄진다.
- 트랜스코딩 완료 큐 : 비디오 트랜스코딩 완료 이벤트를 보관할 메세지 큐다
- 트랜스코딩 완료 핸들러 : 트랜스 코딩 완료 큐에서 이벤트 데이터를 꺼내어 메타데이터 캐시와 데이터베이스를 갱신할 작업 서버들이다.

** 프로세스 : 비디오 업로드, 메타데이터(비디오 url, 크기, 해상도, 포맷, 사용자 정보가 포함된다.) 갱신 2가지가 병렬적으로 수행된다.
- 비디오 업로드
- 메타데이터 갱신   
<br/>
  
### 비디오 스트리밍 절차

<br/>


## 3단계. 상세 설계
### 비디오 트랜스 코딩
### 유향 비순환 그래프 dag 모델
### 비디오 트랜스 코딩 아키텍처
### 시스템 최적화
### 오류 처리

## 4단계. 마무리

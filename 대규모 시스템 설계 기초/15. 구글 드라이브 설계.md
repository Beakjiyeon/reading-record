# 15. 구글 드라이브 설계
# 1단계. 문제 이해 및 설계 범위 확정
- 기능적 요구사항
  - 파일 추가
  - 파일 다운로드
  - 여러 단말에 파일 동기화
  - 파일 갱신 이력 조회
  - 파일 공유
  - 파일 편집, 삭제될 경우 알림
  - 여러 사용자가 같은 문서를 동시에 편집하는 기능은 범위에서 제외한다.
- 비기능적 요구사항
  - 안정성 : 데이터 손실 방지
  - 빠른 동기화 속도
  - 네트워크 대역폭이 너무 커선 안된다.
  - 규모 확장성 : 아주 많은 양의 트래픽 처리 가능해야 함
  - 높은 가용성 : 일부 서버 장애, 느려지거나, 네트워크 일부가 끊겨도 시스템은 계속 사용 가능해야 한다.
- 개략적 추정치
<br/>
  
# 2단계. 개략적 설계안 제시 및 동의 구하기
- 필요한 api
  - 파일 업로드 api : 단순 업로드(파일 크기 작은경우), 이어 올리기(파일이 크거나 네트워크 장애 발생 가능성 있는 경우)
  - 파일 다운로드 api
  - 파일 갱신 히스토리 api
  - 모두 사용자 인증을 필요로 하고 https 프로토콜을 사용해야 한다. 데이터를 보호하기 위함
- 업로드 되는 파일이 많아지면 파일시스템을 가득 차게 되므로 데이터를 여러 서버에 나누어 샤딩(저장)해야 한다.
  - 데이터 다중화를 위해 s3 버킷에 저장한다. 가용성과 데이터 무손실을 보장하기 위해 다중화한다.
- 로드밸런서를 통해 네트워크 트래픽을 분산한다. 또한 특정 웹 서버에 장애가 발생하면 자동으로 해당 서버를 우회해 준다.
- 메타데이터 데이터 베이스 : 데이터베이스를 파일 저장 서버에서 분리하여 싱글 포인트 오브 페일러를 회피한다. 아울러 다중화, 샤딩 정책을 적용하여 가용성과 규모 확장성 요구사항에 대응한다.
- 개략적 설계안 컴포넌트
  - 블록 저장소 서버
    - 파일블록을 클라우드 저장소에 업로드하는 서버다.
    - 파일을 여러 개의 블록으로 나눠 저장하며 각 블록에는 고유한 해시값이 할당된다.
    - 해시 값은 메타데이터 데이스 베이스에 저장된다. 각 블록은 독립적인 객체로 취급되며 s3(클라우드 저장소)에 보관딘다.
  - 아카이빙 저장소 : 오랫동안 사용되지 않은 비활성 데이터를 저장하기 위한 컴퓨터 시스템
  - 로드 밸런서
  - 클라우드 저장소
  - api 서버 : 파일 업로드 외 거의 모든 기능. 사용자 인증, 사용자 프로필 관리, 파일 메타데이터 갱신 등
  - 메타데이터 데이스 베이스 : 사용자, 파일, 블록, 버전 등 정보 관리. 실제 파일은 클라우드에, 이 데이터베이스엔 오직 메타정보만 둔다.
  - 메타데이터 캐시 : 성능을 높이 기 위해 자주 쓰이는 메타 데이터는 캐시한다.
  - 알림 서비스 : 발생/구독 프로토콜 기반 시스템이다.
  - 오프라인 사용자 백업 큐 : 클라이언트가 접속 중이 아니라서 파일의 최신 상태를 확인할 수 없을 땐 해당 정보를 이 큐에 두어 나중에 클라이언트가 접속했을 때 동기화될 수 있도록한다.
<br/>

# 3단계. 상세 설계
# 4단계. 마무리
